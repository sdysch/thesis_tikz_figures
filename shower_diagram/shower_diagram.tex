\begin{tikzpicture}[scale=0.8]

	% TODO, tidy up code with foreach loops?

	% diagrams

	% small gluons
	\tikzset{
		smallGluon/.style={decorate, draw=black,
		decoration={coil,aspect=0.3,segment length=3pt,amplitude=2pt}}
	 }

	% very small ellipse used for parton to hadron transistions
	\def\verySmallEllipseRx{0.5 * \smallEllipseRx}
	\def\verySmallEllipseRy{0.5 * \smallEllipseRy}
	\def\manualRotationOffset{225}

	% hadronisation diagram 1
	\tikzset{
		hadronisation/.code args = {#1, #2, #3}{%
			% thick lines
			%\foreach \i in {-0.1, 0.1} \draw[rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.5 + \i , #2 - 0.5 + \i);
			% big particle decay
			\draw[dashed, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.5 , #2 - 0.5);
			\draw[dashed, color = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.5 , #2 - 0.5) -- (#1 + 0.95, #2 - 0.75);
			\draw[dashed, color = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.5 , #2 - 0.5) -- (#1 + 0.75, #2 - 0.95);
			\draw[color = black, fill = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.95, #2 - 0.75) circle (0.05);
			\draw[color = black, fill = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.75, #2 - 0.95) circle (0.05);
			\draw[color = black, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, fill = green!110] (#1 + 0.5 , #2 - 0.5) circle (0.075);
			% little particle
			\draw[dashed, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.3, #2 - 0.7);
			\draw[color = black, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, fill = green!110] (#1 + 0.3 , #2 - 0.7) circle (0.05);
			\draw[dashed, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.7 , #2 - 0.3);
			\draw[color = black, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, fill = green!110] (#1 + 0.7 , #2 - 0.3) circle (0.05);
			% ellipse for hadronization vertex
			\draw[color = black, fill = blue] (#1, #2) circle [x radius = \verySmallEllipseRx, y radius = \verySmallEllipseRy, rotate = #3];
		}
	}

	% hadronisation diagram 2
	\tikzset{
		hadronisation2/.code args = {#1, #2, #3}{%
			% thick lines
			%\foreach \i in {-0.1, 0.1} \draw[rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.5 + \i , #2 - 0.5 + \i);
			% big particle decay
			\draw[dashed, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.3 , #2 - 0.7);
			\draw[dashed, color = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.3 , #2 - 0.7) -- (#1 + 0.75, #2 - 0.95);
			\draw[dashed, color = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.3 , #2 - 0.7) -- (#1 + 0.55, #2 - 1.15);
			\draw[color = black, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, fill = green!110] (#1 + 0.3 , #2 - 0.7) circle (0.075);
			\draw[color = black, fill = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.75, #2 - 0.95) circle (0.05);
			\draw[color = black, fill = green!110, rotate around = {#3 + \manualRotationOffset:(#1, #2)}] (#1 + 0.55, #2 - 1.15) circle (0.05);
			% little particle
			\draw[dashed, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.7 , #2 - 0.3);
			\draw[color = black, rotate around = {#3 + \manualRotationOffset:(#1, #2)}, fill = green!110] (#1 + 0.7 , #2 - 0.3) circle (0.05);
			% ellipse for hadronization vertex
			\draw[color = black, fill = blue] (#1, #2) circle [x radius = \verySmallEllipseRx, y radius = \verySmallEllipseRy, rotate = #3];
		}
	}

	% hadronisation diagram with smaller decay
	\tikzset{
		hadronisationSmallDecay/.code args = {#1, #2, #3}{%
			\foreach \i in {-0.3, -0.1, 0.1, 0.3} \draw[rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110] (#1, #2) -- (#1 + 0.25 + \i , #2 - 0.25 + \i);
			\foreach \i in {-0.2, 0, 0.2} \draw[rotate around = {#3 + \manualRotationOffset:(#1, #2)}, color = green!110, dashed] (#1, #2) -- (#1 + 0.25 + \i , #2 - 0.25 + \i);
			\draw[color = black, fill = blue] (#1, #2) circle [x radius = \verySmallEllipseRx, y radius = \verySmallEllipseRy, rotate = #3];
		}
	}

	% proton scatter diagram
	\tikzset{
		protonScatter/.code args = {#1, #2, #3}{%
			\draw[color = black, fill = cyan] (#1, #2) circle [x radius = 0.75 * \verySmallEllipseRx, y radius = #3];
		}
	}


	% coordinates
	\def\hardScatterRadius{0.3}
	\def\protonPosition{4}
	\def\UEPositionY{-1}
	\def\UEPositionX{0}
	\def\UEOffsetY{0.1}
	\def\UEHadXBase{5}
	\def\UEHadYBase{-4}
	\def\hardScatterX{0}
	\def\hardScatterY{1.5}

	% small ellipse
	\def\smallEllipseRx{0.1}
	\def\smallEllipseRy{4 * \smallEllipseRx}

	%\draw[color = black, thick, fill = green] (0, 1) circle [x radius = \smallEllipseRx, y radius = \smallEllipseRy];

	% arrows
	\tikzset{->-/.style={decoration={
		markings,
		mark=at position #1 with {\arrow{>}}},postaction={decorate}}}

	% valence quarks
	\def\valenceY{0.2}
	\foreach \i in {-1, 1} {
		\draw[color = red, thick, ->-=0.5] (\i * 2 * \protonPosition, -\valenceY) -- (\i * \protonPosition, -\valenceY);
		\draw[color = red, thick, ->-=0.5] (\i * 2 * \protonPosition, 0) -- (\i * \protonPosition, 0);
		\draw[color = red, thick, ->-=0.5] (\i * 2 * \protonPosition, \valenceY) -- (\i * \protonPosition, \valenceY);
	}


	% partons from proton
	\draw[smallGluon, color = orange] (\protonPosition, -3 * \UEOffsetY) -- (\UEPositionX, \UEPositionY - 1 * \UEOffsetY);
	\draw[smallGluon, color = orange] (-\protonPosition, -3 * \UEOffsetY) -- (\UEPositionX, \UEPositionY - 1 * \UEOffsetY);
	\draw[smallGluon, color = orange] (\protonPosition, -1 * \UEOffsetY) -- (\UEPositionX, \UEPositionY + \UEOffsetY);
	\draw[thick, color = orange] (-\protonPosition, -1 * \UEOffsetY) -- (\UEPositionX, \UEPositionY + \UEOffsetY);

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Underlying event
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	% underlying event hadronisation + hadronisation
	%FIXME, rotation angle done by eye, not actually calculated from geometry
	\draw[color = orange, thick] (\UEPositionX, \UEPositionY -2 * \UEOffsetY) -- (\UEHadXBase, \UEHadYBase);
	\draw[hadronisation2 = {\UEHadXBase, \UEHadYBase, 150}];

	\draw[smallGluon, color = orange] (-\UEPositionX, \UEPositionY -2 * \UEOffsetY) -- (-\UEHadXBase, \UEHadYBase);
	\draw[hadronisation2 = {-\UEHadXBase, \UEHadYBase, 30}];

	\draw[smallGluon, color = orange] (\UEPositionX, \UEPositionY -2 * \UEOffsetY) -- (0.8 * \UEHadXBase, 1.2 * \UEHadYBase);
	\draw[hadronisation = {0.8 * \UEHadXBase, 1.2 * \UEHadYBase, 140}];

	\draw[color = orange, thick] (-\UEPositionX, \UEPositionY -2 * \UEOffsetY) -- (-0.8 * \UEHadXBase, 1.2 * \UEHadYBase);
	\draw[hadronisation = {-0.8 * \UEHadXBase, 1.2 * \UEHadYBase, 40}];

	\draw[color = orange, thick] (\UEPositionX, \UEPositionY) -- (\UEPositionX, 3 * \UEPositionY);
	\draw[color = orange, thick] (\UEPositionX, 3 * \UEPositionY) -- (\UEPositionX + 2, 5 * \UEPositionY);
	\draw[hadronisation2 = {\UEPositionX + 2, 5 * \UEPositionY, 130}];

	\draw[smallGluon, color = orange] (\UEPositionX, 3 * \UEPositionY) -- (\UEPositionX, 5 * \UEPositionY);
	\draw[hadronisation = {\UEPositionX, 5 * \UEPositionY, 90}];

	\draw[smallGluon, color = orange] (\UEPositionX, 3.5 * \UEPositionY) -- (\UEPositionX - 2, 5 * \UEPositionY);
	\draw[hadronisation2 = {\UEPositionX - 2, 5 * \UEPositionY, 50}];


	% UE ellipse
	\draw[color = black, thick, fill = orange] (\UEPositionX, \UEPositionY) circle [x radius = \smallEllipseRx, y radius = \smallEllipseRy];

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Proton scatter 
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	\draw[color = blue, thick] (-\protonPosition, -0.075) -- (-\protonPosition + 1, -0.075);
	\draw[smallGluon, color = blue] (-\protonPosition, 0.075) -- (-\protonPosition + 1, 0.075);
	\draw[protonScatter = {-\protonPosition + 1, 0, \verySmallEllipseRy}];

	\draw[color = blue, thick] (\protonPosition, 0.075) -- (\protonPosition - 1, 0.075);
	\draw[protonScatter = {\protonPosition - 1, 0.075, \verySmallEllipseRy}];


	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% hard scatter
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	% partons for hard scatter
	\def\quarkGluonVertexX{1.6}
	\def\quarkGluonVertexY{0.5}
	\def\gluonGluonVertexX{-1.6}
	\def\gluonGluonVertexY{0.5}

	\draw[color = blue, thick] (\protonPosition, 0.2) -- (\quarkGluonVertexX, \quarkGluonVertexY);
	\draw[color = blue, thick] (\quarkGluonVertexX, \quarkGluonVertexY) -- (0.5, \quarkGluonVertexY);
	\draw[smallGluon, color = blue] (\quarkGluonVertexX, \quarkGluonVertexY) -- (\hardScatterX + \hardScatterRadius, \hardScatterY);

	\draw[smallGluon, color = blue] (-\protonPosition, 0.2) -- (\gluonGluonVertexX, \gluonGluonVertexY);
	\draw[smallGluon, color = blue] (\gluonGluonVertexX, \gluonGluonVertexY) -- (-0.5, \gluonGluonVertexY);
	\draw[smallGluon, color = blue] (\gluonGluonVertexX, \gluonGluonVertexY) -- (\hardScatterX - \hardScatterRadius, \hardScatterY);

	% hadronisation
	\draw[hadronisationSmallDecay = {0.5, \quarkGluonVertexY, 0}];
	\draw[hadronisationSmallDecay = {-0.5, \gluonGluonVertexY, 180}];

	% protons
	\draw[color = black, thick, fill = red] (-\protonPosition, 0) circle [x radius = \smallEllipseRx, y radius = \smallEllipseRy];
	\draw[color = black, thick, fill = red] (\protonPosition, 0) circle [x radius = \smallEllipseRx, y radius = \smallEllipseRy];

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% parton shower
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	% partons from hard scatter
	% 0.70710678118 = sin 45 = cos 45
	% 0.86602540378 = sqrt(3) / 2
	% 0.5 = sin (30)
	\draw[smallGluon, color = magenta] (\hardScatterX - \hardScatterRadius * 0.70710678118, \hardScatterY + \hardScatterRadius * 0.70710678118) -- (\hardScatterX - 3, \hardScatterY + 1.5);
	\draw[hadronisation = {\hardScatterX - 3, \hardScatterY + 1.5, -30}];

	\draw[smallGluon, color = magenta] (\hardScatterX - 1.5, \hardScatterY + 0.75) -- (\hardScatterX - 3.5, \hardScatterY + 0.5);
	\draw[hadronisation2 = {\hardScatterX - 3.5, \hardScatterY + 0.5, 5}];

	\draw[color = magenta, thick] (\hardScatterX + \hardScatterRadius * 0.70710678118, \hardScatterY + \hardScatterRadius * 0.70710678118) -- (\hardScatterX + 2, \hardScatterY + 2);
	\draw[color = magenta, thick] (\hardScatterX, \hardScatterY + \hardScatterRadius) -- (\hardScatterX, \hardScatterY + 2);
	\draw[color = magenta, thick] (\hardScatterX - \hardScatterRadius * 0.5, \hardScatterY + \hardScatterRadius * 0.86602540378) -- (\hardScatterX - 1, \hardScatterY + 2);

	\draw[smallGluon, color = magenta] (\hardScatterX + \hardScatterRadius * 0.5, \hardScatterY + \hardScatterRadius * 0.86602540378) -- (\hardScatterX + 1, \hardScatterY + 2);
	\draw[hadronisation = {\hardScatterX + 1, \hardScatterY + 2, -120}];

	\draw[smallGluon, color = magenta] (\hardScatterX - 1, \hardScatterY + 2) -- (\hardScatterX - 1.2, \hardScatterY + 3);
	\draw[hadronisation = {\hardScatterX - 1.2, \hardScatterY + 3, -70}];

	\draw[smallGluon, color = magenta] (\hardScatterX + \hardScatterRadius, \hardScatterY) -- (\hardScatterX + 2, \hardScatterY + 0.5);
	\draw[hadronisation = {\hardScatterX + 2, \hardScatterY + 0.5, 190}];

	% decays from magenta blobs
	\foreach \i in {-0.1, 0.1} {
		\draw[color = magenta, thick] (\hardScatterX + 2, \hardScatterY + 2) -- (\hardScatterX + 3 + \i, \hardScatterY + 3 - \i);
		\draw[color = magenta, thick] (\hardScatterX, \hardScatterY + 2) -- (\hardScatterX + \i, \hardScatterY + 3.5);
		\draw[color = magenta, thick] (\hardScatterX - 1, \hardScatterY + 2) -- (\hardScatterX - 2 - \i, \hardScatterY + 3 - \i);
	}

	% hadronisation from magenta blobs
	\draw[hadronisation2 = {\hardScatterX + 3, \hardScatterY + 3, 220}];
	\draw[hadronisation = {\hardScatterX, \hardScatterY + 3.5, -90}];
	\draw[hadronisation2 = {\hardScatterX - 2, \hardScatterY + 3, 220 + 90}];

	% magenta blobs
	\draw[color = black, fill = magenta, thick] (\hardScatterX + 2, \hardScatterY + 2) circle (0.5 * \hardScatterRadius);
	\draw[color = black, fill = magenta, thick] (\hardScatterX, \hardScatterY + 2) circle (0.5 * \hardScatterRadius);
	\draw[color = black, fill = magenta, thick] (\hardScatterX - 1, \hardScatterY + 2) circle (0.5 * \hardScatterRadius);

	% blue circle for hard scatter position
	\draw[color = black, thick, pattern = north west lines, pattern color = magenta] (\hardScatterX, \hardScatterY) circle (\hardScatterRadius);

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Key
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	\def\legXmin{-9}
	\def\legXmax{-7}
	\def\legYmin{2}
	\def\legYmax{6}
	\def\keyY{\legYmax - 0.2}
	\def\keyX{\legXmax - 0.2}
	\draw[thick, color = black] (\legXmin - 1, \legYmin) -- (\legXmax + 1.5, \legYmin) -- (\legXmax + 1.5, \legYmax);
	%\node at (\legXmin, \legYmax) {Key};

	\node at (\legXmin, \keyY) {Hard scatter};
	\draw[color = black, thick, pattern = north west lines, pattern color = magenta] (\keyX, \keyY) circle (0.5 * \hardScatterRadius);

	\node at (\legXmin, \keyY - 0.75) {Proton beam};
	\draw[color = red, thick, ->-=0.5] (\keyX - 0.3, \keyY - 0.75 - 0.1) -- (\keyX, \keyY - 0.75 - 0.1);
	\draw[color = red, thick, ->-=0.5] (\keyX - 0.3, \keyY - 0.75) -- (\keyX, \keyY - 0.75);
	\draw[color = red, thick, ->-=0.5] (\keyX - 0.3, \keyY - 0.75 + 0.1) -- (\keyX, \keyY - 0.75 + 0.1);
	\draw[color = black, thick, fill = red] (\keyX, \keyY - 0.75) circle [x radius = 0.5 * \smallEllipseRx, y radius = 0.5 * \smallEllipseRy];

	\node at (\legXmin, \keyY - 1.75) {Hadronisation};
	\draw[hadronisation = {\keyX, \keyY - 1.5, 180}];
	\draw[hadronisation2 = {\keyX, \keyY - 2.5, 180}];


\end{tikzpicture}
